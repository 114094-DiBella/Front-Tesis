<div class="reports-container">
  <!-- Header -->
  <div class="reports-header">
    <h1 class="reports-title">Dashboard de Productos</h1>
    <p class="reports-subtitle">Análisis y métricas de tu inventario</p>
  </div>

  <!-- Loading -->
  @if (isLoading) {
    <div class="loading-container">
      <div class="loading-spinner"></div>
      <p>Cargando reportes...</p>
    </div>
  }

  @if (!isLoading) {
    <!-- KPIs Grid -->
    <div class="kpis-grid">
      <!-- Total Productos -->
      <div class="kpi-card primary">
        <div class="kpi-header">
          <div class="kpi-icon primary">
            <i class="fas fa-box"></i>
          </div>
        </div>
        <div class="kpi-value">{{ formatNumber(kpis.totalProducts) }}</div>
        <div class="kpi-label">Total Productos</div>
        <div class="kpi-description">
          {{ kpis.activeProducts }} activos, {{ kpis.inactiveProducts }} inactivos
        </div>
      </div>

      <!-- Total Stock -->
      <div class="kpi-card success">
        <div class="kpi-header">
          <div class="kpi-icon success">
            <i class="fas fa-warehouse"></i>
          </div>
        </div>
        <div class="kpi-value">{{ formatNumber(kpis.totalStock) }}</div>
        <div class="kpi-label">Total Stock</div>
        <div class="kpi-description">
          Promedio: {{ kpis.averageStock }} unidades por producto
        </div>
      </div>

      <!-- Valor Total -->
      <div class="kpi-card info">
        <div class="kpi-header">
          <div class="kpi-icon info">
            <i class="fas fa-dollar-sign"></i>
          </div>
        </div>
        <div class="kpi-value">{{ formatCurrency(kpis.totalValue) }}</div>
        <div class="kpi-label">Valor Total Inventario</div>
        <div class="kpi-description">
          Precio promedio: {{ formatCurrency(kpis.averagePrice) }}
        </div>
      </div>

      <!-- Alertas de Stock -->
      <div class="kpi-card warning">
        <div class="kpi-header">
          <div class="kpi-icon warning">
            <i class="fas fa-exclamation-triangle"></i>
          </div>
        </div>
        <div class="kpi-value">{{ formatNumber(kpis.lowStockProducts) }}</div>
        <div class="kpi-label">Stock Bajo</div>
        <div class="kpi-description">
          {{ kpis.outOfStockProducts }} productos sin stock
        </div>
      </div>

      <!-- Categorías -->
      <div class="kpi-card primary">
        <div class="kpi-header">
          <div class="kpi-icon primary">
            <i class="fas fa-tags"></i>
          </div>
        </div>
        <div class="kpi-value">{{ formatNumber(kpis.totalCategories) }}</div>
        <div class="kpi-label">Categorías Activas</div>
        <div class="kpi-description">
          Más popular: {{ kpis.mostPopularCategory }}
        </div>
      </div>

      <!-- Marcas -->
      <div class="kpi-card info">
        <div class="kpi-header">
          <div class="kpi-icon info">
            <i class="fas fa-award"></i>
          </div>
        </div>
        <div class="kpi-value">{{ formatNumber(kpis.totalBrands) }}</div>
        <div class="kpi-label">Marcas Disponibles</div>
        <div class="kpi-description">
          Más productos: {{ kpis.mostPopularBrand }}
        </div>
      </div>

      <!-- Ventas (si aplica) -->
      @if (kpis.totalOrders > 0) {
        <div class="kpi-card success">
          <div class="kpi-header">
            <div class="kpi-icon success">
              <i class="fas fa-chart-line"></i>
            </div>
          </div>
          <div class="kpi-value">{{ formatCurrency(kpis.totalRevenue) }}</div>
          <div class="kpi-label">Ingresos Totales</div>
          <div class="kpi-description">
            {{ kpis.totalOrders }} órdenes - Ticket promedio: {{ formatCurrency(kpis.averageOrderValue) }}
          </div>
        </div>
      }

      <!-- Precio Promedio -->
      <div class="kpi-card warning">
        <div class="kpi-header">
          <div class="kpi-icon warning">
            <i class="fas fa-calculator"></i>
          </div>
        </div>
        <div class="kpi-value">{{ formatCurrency(kpis.averagePrice) }}</div>
        <div class="kpi-label">Precio Promedio</div>
        <div class="kpi-description">
          Por unidad en inventario
        </div>
      </div>
    </div>

    <!-- Sections Grid -->
    <div class="reports-sections">
      <!-- Productos por Categoría -->
      <div class="report-section">
        <h3 class="section-title">Distribución por Categorías</h3>
        <div class="distribution-table">
          @for (item of productsByCategory; track item.name) {
            <div class="distribution-item">
              <span class="distribution-name">{{ item.name }}</span>
              <span class="distribution-count">{{ item.count }}</span>
            </div>
          }
        </div>
      </div>

      <!-- Productos por Marca -->
      <div class="report-section">
        <h3 class="section-title">Distribución por Marcas</h3>
        <div class="distribution-table">
          @for (item of productsByBrand; track item.name) {
            <div class="distribution-item">
              <span class="distribution-name">{{ item.name }}</span>
              <span class="distribution-count">{{ item.count }}</span>
            </div>
          }
        </div>
      </div>

      <!-- Rangos de Precio -->
      <div class="report-section">
        <h3 class="section-title">Distribución por Precios</h3>
        <div class="distribution-table">
          @for (range of priceRanges; track range.range) {
            <div class="distribution-item">
              <span class="distribution-name">{{ range.range }}</span>
              <span class="distribution-count">{{ range.count }}</span>
            </div>
          }
        </div>
      </div>

      <!-- Top Productos por Valor -->
      <div class="report-section">
        <h3 class="section-title">Productos de Mayor Valor</h3>
        <div class="distribution-table">
          @for (product of topValueProducts.slice(0, 5); track product.id) {
            <div class="distribution-item">
              <div>
                <div class="distribution-name">{{ product.name }}</div>
                <small class="product-brand">{{ product.marca?.name || 'Sin marca' }}</small>
              </div>
              <span class="distribution-count">{{ formatCurrency(product.price || 0) }}</span>
            </div>
          }
        </div>
      </div>
    </div>

    <!-- Productos con Stock Bajo -->
    @if (lowStockProducts.length > 0) {
      <div class="stock-alerts">
        <h3 class="section-title">⚠️ Productos con Stock Bajo</h3>
        <table class="products-table">
          <thead>
            <tr>
              <th>Producto</th>
              <th>Marca</th>
              <th>Categoría</th>
              <th>Stock</th>
              <th>Precio</th>
              <th>Estado</th>
            </tr>
          </thead>
          <tbody>
            @for (product of lowStockProducts; track product.id) {
              <tr>
                <td>
                  <div class="product-name">{{ product.name }}</div>
                </td>
                <td>{{ product.marca?.name || 'Sin marca' }}</td>
                <td>{{ product.category?.name || 'Sin categoría' }}</td>
                <td>{{ product.stock }}</td>
                <td class="product-price">{{ formatCurrency(product.price || 0) }}</td>
                <td>
                  <span class="stock-badge" [class]="getStockStatusClass(Number(product.stock))">
                    {{ getStockStatus(Number(product.stock)) }}
                  </span>
                </td>
              </tr>
            }
          </tbody>
        </table>
      </div>
    }
  }
</div>